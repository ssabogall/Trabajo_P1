{% extends 'base.html' %}

{% block content %}
<div class="container mt-5 daily-report-container">
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="text-center">üìä Reporte diario de ventas</h1>
            <h4 class="text-center text-muted">{{ report_date|date:"d/m/Y" }}</h4>
        </div>
        <div class="col-md-4 text-right">
            <form method="GET" class="form-inline justify-content-end">
                <div class="form-group">
                    <label for="date" class="sr-only">Fecha:</label>
                    <input type="date" id="date" name="date" class="form-control mr-2" 
                           value="{{ report_date|date:'Y-m-d' }}">
                </div>
                <button type="submit" class="btn btn-primary">Ver reporte</button>
            </form>
        </div>
    </div>

    <!-- M√©tricas principales -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card bg-primary shadow report-card">
                <div class="card-body text-center">
                    <h3 class="card-title report-text">{{ total_revenue|floatformat:0 }}</h3>
                    <p class="card-text report-text">üí∞ Ingreso total</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-success shadow report-card">
                <div class="card-body text-center">
                    <h3 class="card-title report-text">{{ total_orders }}</h3>
                    <p class="card-text report-text">üìã Cantidad de pedidos</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-info shadow report-card">
                <div class="card-body text-center">
                    <h3 class="card-title report-text">{{ average_per_order|floatformat:0 }}</h3>
                    <p class="card-text report-text">üí∏ Promedio por pedido</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Productos m√°s vendidos -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-warning">
                    <h5 class="mb-0 report-text">üèÜ Producto m√°s vendido</h5>
                </div>
                <div class="card-body">
                    {% if most_sold_products %}
                        <table class="table table-sm report-table">
                            <thead>
                                <tr>
                                    <th class="report-text">Producto</th>
                                    <th class="report-text">Cantidad</th>
                                    <th class="report-text">Ventas</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product_name, data in most_sold_products %}
                                <tr>
                                    <td class="report-text">{{ product_name }}</td>
                                    <td class="report-text"><span class="badge badge-primary report-badge">{{ data.total_quantity }}</span></td>
                                    <td class="report-text">${{ data.total_sales|floatformat:0 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="text-muted report-text">No hay productos registrados en este periodo.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- M√©todos de pago -->
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-secondary">
                    <h5 class="mb-0 report-text">üí≥ Formas de pago</h5>
                </div>
                <div class="card-body">
                    {% if payment_methods %}
                        <table class="table table-sm report-table">
                            <thead>
                                <tr>
                                    <th class="report-text">M√©todo de pago</th>
                                    <th class="report-text">Pedidos</th>
                                    <th class="report-text">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for method, data in payment_methods %}
                                <tr>
                                    <td class="report-text">
                                        {% if method == "Cash" %}
                                            üíµ Efectivo
                                        {% elif method == "Transfer" %}
                                            üè¶ Transferencia
                                        {% else %}
                                            {{ method }}
                                        {% endif %}
                                    </td>
                                    <td class="report-text"><span class="badge badge-success report-badge">{{ data.count }}</span></td>
                                    <td class="report-text">${{ data.total_amount|floatformat:0 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="text-muted report-text">No hay transacciones registradas en este periodo.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Detalle de √≥rdenes del d√≠a -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header" style="background-color: rgb(139, 54, 142);">
                    <h5 class="mb-0 report-text">üìù Detalles de los pedidos diarios</h5>
                </div>
                <div class="card-body">
                    {% if daily_orders %}
                        <table class="table table-bordered table-hover report-table">
                            <thead class="thead-light">
                                <tr>
                                    <th class="report-text">Hora</th>
                                    <th class="report-text">M√©todo de pago</th>
                                    <th class="report-text">Productos</th>
                                    <th class="text-right report-text">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in daily_orders %}
                                <tr>
                                    <td class="report-text">{{ order.date|date:"H:i" }}</td>
                                    <td class="report-text">
                                        {% if order.paymentMethod == "Cash" %}
                                            <span class="badge badge-success report-badge">üíµ Efectivo</span>
                                        {% elif order.paymentMethod == "Transfer" %}
                                            <span class="badge badge-info report-badge">üè¶ Transferencia</span>
                                        {% else %}
                                            <span class="badge badge-secondary report-badge">{{ order.paymentMethod }}</span>
                                        {% endif %}
                                    </td>
                                    <td class="report-text">{{ order.products|linebreaksbr }}</td>
                                    <td class="text-right font-weight-bold report-text">${{ order.total_amount|floatformat:0 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <div class="text-center py-4">
                            <p class="text-muted report-text">üìã No hay pedidos registrados para esta fecha.</p>
                            <small class="report-text">Selecciona otra fecha o verifica que existan ventas registradas.</small>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Botones de acci√≥n -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <a href="{% url 'orders' %}" class="btn btn-outline-primary mr-2">
                ‚Üê Volver a ventas
            </a>
            <button onclick="window.print()" class="btn btn-outline-secondary">
                üñ®Ô∏è Imprimir reporte
            </button>
        </div>
    </div>
</div>

<!-- Estilos espec√≠ficos para el reporte diario -->
<style>
/* 
 * Estilos del reporte diario - Forzar texto negro para mejor legibilidad
 * Estos estilos sobrescriben las clases text-white de Bootstrap
 */

/* Aplicar color negro a todo el texto dentro del contenedor del reporte */
.daily-report-container .report-text,
.daily-report-container .report-text *,
.daily-report-container .report-card .card-title,
.daily-report-container .report-card .card-text,
.daily-report-container .report-table,
.daily-report-container .report-table th,
.daily-report-container .report-table td,
.daily-report-container .report-table thead,
.daily-report-container .report-table tbody,
.daily-report-container .report-badge {
    color: #000 !important;
}

/* Asegurar que todos los elementos de la tabla tengan texto negro */
.daily-report-container table,
.daily-report-container table *,
.daily-report-container .table,
.daily-report-container .table th,
.daily-report-container .table td {
    color: #000 !important;
}

/* Sobrescribir colores de las insignias (badges) */
.daily-report-container .badge,
.daily-report-container .report-badge {
    color: #000 !important;
    background-color: #e9ecef !important;
    border: 1px solid #dee2e6 !important;
}

/* Asegurar que los encabezados de las tarjetas tengan texto negro */
.daily-report-container .card-header h5,
.daily-report-container .card-header .report-text {
    color: #000 !important;
}

/* Sobrescribir clases text-white en las tarjetas del reporte */
.daily-report-container .card.bg-primary .report-text,
.daily-report-container .card.bg-success .report-text,
.daily-report-container .card.bg-info .report-text,
.daily-report-container .card.bg-secondary .report-text,
.daily-report-container .card.bg-dark .report-text {
    color: #000 !important;
}

/* Asegurar que text-muted tambi√©n sea negro en los reportes */
.daily-report-container .text-muted,
.daily-report-container .text-muted.report-text {
    color: #000 !important;
}

/* Estilos para impresi√≥n */
@media print {
    /* Ocultar botones y formularios al imprimir */
    .btn, 
    .form-group, 
    .form-inline,
    button {
        display: none !important;
    }
    
    /* Ancho completo al imprimir */
    .container {
        max-width: 100% !important;
    }
    
    /* Todo el texto en negro al imprimir */
    * {
        color: #000 !important;
    }
    
    /* Quitar colores de fondo para mejor impresi√≥n */
    .card {
        border: 1px solid #000 !important;
    }
}
</style>
{% endblock %}
